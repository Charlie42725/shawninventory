# åº«å­˜ç®¡ç†ç³»çµ± v2 - éƒ¨ç½²æŒ‡å—

## ðŸ“‹ ç³»çµ±éœ€æ±‚

- Node.js 18+
- Supabase å¸³è™Ÿ
- ç¶²é ç€è¦½å™¨

## ðŸš€ å¿«é€Ÿé–‹å§‹

### 1. è³‡æ–™åº«è¨­å®š

1. ç™»å…¥ [Supabase Dashboard](https://app.supabase.com/)
2. é¸æ“‡ä½ çš„å°ˆæ¡ˆ
3. é»žæ“Šå·¦å´é¸å–®çš„ **SQL Editor**
4. åŸ·è¡Œ `database_schema_v2.sql` ä¸­çš„æ‰€æœ‰ SQL æŒ‡ä»¤

é€™æœƒå‰µå»ºä»¥ä¸‹è¡¨æ ¼:
- `product_categories` - ç”¢å“é¡žåˆ¥ (æœé£¾/éž‹å­/æ½®çŽ©/é£¾å“)
- `products` - ç”¢å“åº«å­˜ä¸»è¡¨
- `stock_in` - é€²è²¨è¨˜éŒ„
- `sales` - éŠ·å”®è¨˜éŒ„
- `inventory_movements` - åº«å­˜ç•°å‹•è¨˜éŒ„

### 2. ç’°å¢ƒè®Šæ•¸é…ç½®

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å‰µå»º `.env.local` æª”æ¡ˆ:

```env
NEXT_PUBLIC_SUPABASE_URL=ä½ çš„_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=ä½ çš„_anon_key
SUPABASE_SERVICE_ROLE_KEY=ä½ çš„_service_role_key
```

> ðŸ’¡ å¯ä»¥åœ¨ Supabase Dashboard > Settings > API æ‰¾åˆ°é€™äº›é‡‘é‘°

### 3. å®‰è£ä¾è³´ä¸¦å•Ÿå‹•

```bash
# å®‰è£ä¾è³´
npm install

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
npm run dev
```

è¨ªå• http://localhost:3000/inventory-v2

## ðŸ“¦ æ ¸å¿ƒåŠŸèƒ½

### åº«å­˜ç®¡ç† (/inventory-v2)

**æŒ‰é¡žåˆ¥ç®¡ç†åº«å­˜:**
- æœé£¾: S/M/L/XL/2XL/3XL å°ºå¯¸
- éž‹å­: US5.5~US11 éž‹ç¢¼
- æ½®çŽ©: ç„¡å°ºå¯¸,æœ‰ IP åˆ†é¡ž
- é£¾å“: US5~US11 å°ºå¯¸

**é€²è²¨æµç¨‹:**
1. é¸æ“‡é¡žåˆ¥
2. è¼¸å…¥ç”¢å“åç¨±å’Œé¡è‰²
3. ç‚ºæ¯å€‹å°ºå¯¸è¼¸å…¥æ•¸é‡
4. è¼¸å…¥å–®åƒ¹æˆæœ¬
5. ç³»çµ±è‡ªå‹•:
   - è¨ˆç®—ç¸½æˆæœ¬
   - æ›´æ–°ç”¢å“åº«å­˜ (æˆ–å‰µå»ºæ–°ç”¢å“)
   - åˆä½µç›¸åŒå°ºå¯¸åº«å­˜
   - è¨ˆç®—åŠ æ¬Šå¹³å‡æˆæœ¬
   - è¨˜éŒ„åº«å­˜ç•°å‹•

### éŠ·å”®ç®¡ç† (/sales-v2)

**éŠ·å”®æµç¨‹:**
1. é¸æ“‡ç¾æœ‰ç”¢å“
2. é¸æ“‡å°ºå¯¸ (å¦‚æžœæœ‰)
3. è¼¸å…¥å®¢æˆ¶é¡žåž‹ (é›¶å”®/æ‰¹ç™¼/é è³¼)
4. é¸æ“‡é€šè·¯å’Œé‹é€æ–¹å¼
5. è¼¸å…¥å–®åƒ¹å’Œæ•¸é‡
6. ç³»çµ±è‡ªå‹•:
   - æª¢æŸ¥åº«å­˜æ˜¯å¦è¶³å¤ 
   - æ‰£æ¸›å°æ‡‰å°ºå¯¸åº«å­˜
   - æ›´æ–°ç”¢å“ç¸½åº«å­˜
   - æŒ‰æ¯”ä¾‹æ¸›å°‘æˆæœ¬
   - è¨˜éŒ„åº«å­˜ç•°å‹•

**åˆªé™¤éŠ·å”®è¨˜éŒ„:**
- åˆªé™¤æ™‚æœƒè‡ªå‹•æ¢å¾©åº«å­˜
- æ¢å¾©å°æ‡‰å°ºå¯¸çš„æ•¸é‡

## ðŸ”‘ API ç«¯é»ž

### é¡žåˆ¥ç®¡ç†
```
GET  /api/v2/categories         # å–å¾—æ‰€æœ‰é¡žåˆ¥
```

### ç”¢å“ç®¡ç†
```
GET  /api/v2/products           # å–å¾—ç”¢å“åˆ—è¡¨
GET  /api/v2/products?category_id=1  # ç¯©é¸ç‰¹å®šé¡žåˆ¥
```

### é€²è²¨ç®¡ç†
```
GET  /api/v2/stock-in           # æŸ¥è©¢é€²è²¨è¨˜éŒ„
POST /api/v2/stock-in           # å‰µå»ºé€²è²¨è¨˜éŒ„
```

**POST Body ç¯„ä¾‹:**
```json
{
  "date": "2025-01-15",
  "order_type": "é€²è²¨",
  "category_id": 1,
  "product_name": "æ£‰è³ªTæ¤",
  "color": "ç™½è‰²",
  "size_quantities": {
    "S": 10,
    "M": 20,
    "L": 15,
    "XL": 10
  },
  "unit_cost": 150
}
```

### éŠ·å”®ç®¡ç†
```
GET    /api/v2/sales            # æŸ¥è©¢éŠ·å”®è¨˜éŒ„
POST   /api/v2/sales            # å‰µå»ºéŠ·å”®è¨˜éŒ„
DELETE /api/v2/sales?id=123     # åˆªé™¤éŠ·å”®è¨˜éŒ„ (æ¢å¾©åº«å­˜)
```

**POST Body ç¯„ä¾‹:**
```json
{
  "date": "2025-01-15",
  "customer_type": "é›¶å”®",
  "product_id": 5,
  "size": "M",
  "channel": "ç¤¾åœ˜",
  "shipping_method": "åº—åˆ°åº—",
  "unit_price": 299,
  "quantity": 2
}
```

## ðŸ“Š è³‡æ–™çµæ§‹èªªæ˜Ž

### å°ºå¯¸åº«å­˜ (JSON)

æœé£¾ç”¢å“ç¯„ä¾‹:
```json
{
  "S": 10,
  "M": 20,
  "L": 15,
  "XL": 10,
  "2XL": 5,
  "3XL": 3
}
```

éž‹å­ç”¢å“ç¯„ä¾‹:
```json
{
  "US7": 8,
  "US7.5": 10,
  "US8": 12,
  "US8.5": 10,
  "US9": 8
}
```

æ½®çŽ©ç”¢å“ (ç„¡å°ºå¯¸):
```json
{}
```

### æˆæœ¬è¨ˆç®—

**é€²è²¨æ™‚ - åŠ æ¬Šå¹³å‡:**
```
æ–°å¹³å‡æˆæœ¬ = (åŽŸç¸½æˆæœ¬ + é€²è²¨ç¸½æˆæœ¬) / (åŽŸç¸½åº«å­˜ + é€²è²¨æ•¸é‡)
```

**éŠ·å”®æ™‚ - æŒ‰æ¯”ä¾‹æ¸›å°‘:**
```
æ–°ç¸½æˆæœ¬ = åŽŸç¸½æˆæœ¬ Ã— (å‰©é¤˜åº«å­˜ / åŽŸç¸½åº«å­˜)
```

## ðŸ” å¸¸è¦‹å•é¡Œ

### Q: ç‚ºä»€éº¼è¦ç”¨ JSON å„²å­˜å°ºå¯¸?
A: ä¸åŒé¡žåˆ¥çš„å°ºå¯¸é…ç½®ä¸åŒ,ä½¿ç”¨ JSON å¯ä»¥éˆæ´»æ“´å±•,ä¸éœ€è¦ç‚ºæ¯å€‹é¡žåˆ¥å»ºç«‹ä¸åŒçš„è¡¨æ ¼çµæ§‹ã€‚

### Q: å¦‚ä½•æ–°å¢žç”¢å“é¡žåˆ¥?
A: åœ¨è³‡æ–™åº« `product_categories` è¡¨æ–°å¢žè¨˜éŒ„,ä¸¦åœ¨ `size_config` æ¬„ä½å®šç¾©å°ºå¯¸:
```sql
INSERT INTO product_categories (name, size_config)
VALUES ('æ–°é¡žåˆ¥', '{"sizes": ["å°ºå¯¸1", "å°ºå¯¸2"]}'::jsonb);
```

### Q: éŠ·å”®è¨˜éŒ„å¯ä»¥ä¿®æ”¹å—Ž?
A: ç›®å‰åªæ”¯æ´åˆªé™¤(æœƒæ¢å¾©åº«å­˜)ã€‚å¦‚éœ€ä¿®æ”¹,å»ºè­°åˆªé™¤å¾Œé‡æ–°å‰µå»ºã€‚

### Q: å¦‚ä½•åŒ¯å‡ºå ±è¡¨?
A: å¯ä»¥ä½¿ç”¨ Supabase Dashboard çš„ SQL Editor åŸ·è¡ŒæŸ¥è©¢:

**éŠ·å”®çµ±è¨ˆ:**
```sql
SELECT
  pc.name as category,
  p.product_name,
  SUM(s.quantity) as total_sold,
  SUM(s.total_amount) as total_revenue
FROM sales s
JOIN products p ON s.product_id = p.id
JOIN product_categories pc ON p.category_id = pc.id
WHERE s.date >= '2025-01-01'
GROUP BY pc.name, p.product_name
ORDER BY total_revenue DESC;
```

**åº«å­˜è­¦ç¤º:**
```sql
SELECT
  pc.name as category,
  p.product_name,
  p.color,
  p.total_stock,
  p.avg_unit_cost,
  p.total_cost_value
FROM products p
JOIN product_categories pc ON p.category_id = pc.id
WHERE p.total_stock < 10
ORDER BY p.total_stock ASC;
```

## ðŸš¨ æ³¨æ„äº‹é …

1. **è³‡æ–™å‚™ä»½**: å®šæœŸåœ¨ Supabase Dashboard å‚™ä»½è³‡æ–™åº«
2. **æ¬Šé™ç®¡ç†**: ç›®å‰ä½¿ç”¨ service role key,ç”Ÿç”¢ç’°å¢ƒæ‡‰å¯¦ä½œ RLS
3. **æˆæœ¬æº–ç¢ºæ€§**: ç¢ºä¿æ¯æ¬¡é€²è²¨éƒ½æ­£ç¢ºå¡«å¯«æˆæœ¬,å½±éŸ¿å¾ŒçºŒè¨ˆç®—
4. **åº«å­˜ç›¤é»ž**: å®šæœŸæ ¸å°å¯¦éš›åº«å­˜èˆ‡ç³»çµ±åº«å­˜

## ðŸ“ˆ æœªä¾†æ“´å±•

- [ ] Excel æ‰¹é‡åŒ¯å…¥éŠ·å”®è¨˜éŒ„
- [ ] å ±è¡¨èˆ‡åœ–è¡¨è¦–è¦ºåŒ–
- [ ] åº«å­˜é è­¦é€šçŸ¥
- [ ] ä¾›æ‡‰å•†ç®¡ç†
- [ ] å¤šå¹£åˆ¥æ”¯æ´
- [ ] è¡Œå‹•è£ç½® APP

## ðŸ†˜ æŠ€è¡“æ”¯æ´

é‡åˆ°å•é¡Œè«‹æª¢æŸ¥:
1. Supabase è³‡æ–™åº«æ˜¯å¦æ­£ç¢ºè¨­å®š
2. ç’°å¢ƒè®Šæ•¸æ˜¯å¦é…ç½®æ­£ç¢º
3. ç€è¦½å™¨ Console æ˜¯å¦æœ‰éŒ¯èª¤è¨Šæ¯

## ðŸ“ ç‰ˆæœ¬èªªæ˜Ž

**v2.0.0 (2025-01-15)**
- âœ¨ å…¨æ–°è³‡æ–™åº«çµæ§‹
- ðŸŽ¨ æ”¯æ´å››å¤§ç”¢å“é¡žåˆ¥
- ðŸ“ éˆæ´»çš„å°ºå¯¸ç®¡ç†ç³»çµ±
- ðŸ’° è‡ªå‹•æˆæœ¬è¨ˆç®—
- ðŸ“Š åº«å­˜ç•°å‹•è¿½è¹¤
